---
title: "R Notebook"
output: pdf
---

# Annex Sensitivity of Catch22 Features

```{r}
# Reshape sensitivity subset data to a long format
subset_sensitivity_joined_long <- subset_sensitivity_joined %>%
  pivot_longer(cols = c(everyNthSensitivity, PercentageChangeSensitivity), 
               names_to = "Method", 
               values_to = "StandardDeviation")

# Change the Method into a factor and set the levels
subset_sensitivity_joined_long$Method <- factor(subset_sensitivity_joined_long$Method, levels = c("PercentageChangeSensitivity", "everyNthSensitivity"))

# Recode the names of the Methods
subset_sensitivity_joined_long$Method <- recode(subset_sensitivity_joined_long$Method,  
                                                "PercentageChangeSensitivity" = "Percentage Change", 
                                                "everyNthSensitivity" = "EveryNth")
# Recode the names of the Rcatch22 features
subset_sensitivity_joined_long$names <- recode(subset_sensitivity_joined_long$names,  
                                               'CO_f1ecac' = "Autocorrelation_ApproxScale",
                                               'CO_FirstMin_ac' = "Autocorrelation_FirstMinimum",
                                               'SB_BinaryStats_mean_longstretch1' = "LongestSuccessivePeriod_AboveAverage",
                                               'PD_PeriodicityWang_th0_01' = "Autocorrelation_FirstPeak",
                                               'DN_Mean' = 'Mean',
                                               'DN_HistogramMode_10' = "HistogramBin10",
                                               'DN_Spread_Std' = 'Spead',
                                               'CO_Embed2_Dist_tau_d_expfit_meandiff' = "DistributionExponentialFit_MeanAbsoluteError",
                                               'IN_AutoMutualInfoStats_40_gaussian_fmmi' = "Autocorrelation_Automutual",
                                               'SB_BinaryStats_diff_longstretch0' = "LongestSuccessivePeriod_SuccessiveDecreases")

# Create a bar plot
sensitive_subset_plot <- ggplot(subset_sensitivity_joined_long, aes(x = StandardDeviation, y = names, fill = Method)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  theme_minimal() +
  theme(text = element_text(size = 30), legend.position = "top") +
  labs(x = "Standard Deviation", y = "Catch22 Feature", fill = "Method", title = "Standard Deviation of Most Sensitive Features") +
  scale_fill_brewer(palette = "Paired") +
  scale_x_continuous(limits = c(0, NA))
```

```{r}
knitr::kable((sensitivity_joined), caption = "Sensitivity of Catch22 Features to EveryNth and Percentage Change Downsampling")
```

# Annex Top Ten Most Sensitive Catch22 Features

The ten features most impacted by both downsampling algorithms are selected for further investigation. The bar graph below visualises the standard deviation of the *EveryNth* algorithm for these features across all the parameters for each of the nine synthetic time series.

```{r NthSensitivity, echo=FALSE, message=FALSE, warning=FALSE, fig.height=4.1, fig.with=3}
sensitivity_ts_Nth$names <- recode(sensitivity_ts_Nth$names,  
                            'CO_f1ecac' = "Autocorr_ApproxScale",
                            'CO_FirstMin_ac' = "Autocorr_FirstMinimum",
                            'SB_BinaryStats_mean_longstretch1' = "LongestPeriod_AboveAverage",
                            'PD_PeriodicityWang_th0_01' = "Autocorr_FirstPeak",
                            'DN_Mean' = 'Mean',
                            'DN_HistogramMode_10' = "HistogramBin10",
                            'DN_Spread_Std' = 'Spead',
                            'CO_Embed2_Dist_tau_d_expfit_meandiff' = "DistributionExponentialFit_MAE",
                            'IN_AutoMutualInfoStats_40_gaussian_fmmi' = "Autocorr_Automutual",
                            'SB_BinaryStats_diff_longstretch0' = "LongestPeriod_Decreases", 
                            'PD_PeriodicityWang_th0_01' = "Autocorr_FirstPeak")

# Recode the names of the datasets
sensitivity_ts_Nth$dataset <- recode(sensitivity_ts_Nth$dataset,
                         "df100" = "100", 
                         "df200" = "200", 
                         "df300" = "300", 
                         "df400" = "400", 
                         "df500" = "500", 
                         "df600" = "600", 
                         "df700" = "700", 
                         "df800a" = "800A", 
                         "df800b" = "800B")

# Arrange order
sensitivity_ts_Nth <- sensitivity_ts_Nth %>%
  arrange(sensitivity)

# Convert "names" to a factor
sensitivity_ts_Nth$names <- factor(sensitivity_ts_Nth$names, levels = unique(sensitivity_ts_Nth$names))

# Create a bar plot
ggplot(sensitivity_ts_Nth, aes(x = sensitivity, y = names, fill = dataset)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = -0.15), legend.position = "top", legend.justification = c(-0.14, 1)) +
  labs(x = "Standard Deviation", y = "Catch22 Feature", fill = "Method", title = "EveryNth: Standard Deviation of Sensitive Features") +
  scale_fill_brewer(palette = "Blues") +
  scale_x_continuous(limits = c(0, NA))
```

The visualisation above highlights that the impact of downsampling on each catch22 feature is different for each time series type. This holds true for the *Percentage Change* algorithm too. The bar graph below visualises the standard deviation for the same ten features across all the parameters for each of the nine synthetic time series.

```{r PCSensitivity, echo=FALSE, message=FALSE, warning=FALSE, fig.height=5, fig.with=3}
# Recode the names of the Rcatch22 features
sensitivity_ts_PC$names <- recode(sensitivity_ts_PC$names,  
                            'CO_f1ecac' = "Autocorr_ApproxScale",
                            'CO_FirstMin_ac' = "Autocorr_FirstMinimum",
                            'SB_BinaryStats_mean_longstretch1' = "LongestPeriod_AboveAverage",
                            'PD_PeriodicityWang_th0_01' = "Autocorr_FirstPeak",
                            'DN_Mean' = 'Mean',
                            'DN_HistogramMode_10' = "HistogramBin10",
                            'DN_Spread_Std' = 'Spead',
                            'CO_Embed2_Dist_tau_d_expfit_meandiff' = "DistributionExponentialFit_MAE",
                            'IN_AutoMutualInfoStats_40_gaussian_fmmi' = "Autocorr_Automutual",
                            'SB_BinaryStats_diff_longstretch0' = "LongestPeriod_Decreases", 
                            'PD_PeriodicityWang_th0_01' = "Autocorr_FirstPeak")

# Recode the names of the datasets
sensitivity_ts_PC$dataset <- recode(sensitivity_ts_PC$dataset,
                                     "df100" = "100", 
                                     "df200" = "200", 
                                     "df300" = "300", 
                                     "df400" = "400", 
                                     "df500" = "500", 
                                     "df600" = "600", 
                                     "df700" = "700", 
                                     "df800a" = "800A", 
                                     "df800b" = "800B")

# Arrange order
sensitivity_ts_PC <- sensitivity_ts_PC %>%
  arrange(sensitivity)

# Convert "names" to a factor
sensitivity_ts_PC$names <- factor(sensitivity_ts_PC$names, levels = unique(sensitivity_ts_PC$names))

# Create a bar plot
ggplot(sensitivity_ts_PC, aes(x = sensitivity, y = names, fill = dataset)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = -0.15), legend.position = "top", legend.justification = c(-0.14, 1)) +
  labs(x = "Standard Deviation", y = "Catch22 Feature", fill = "Method", title = "Percentage Change: Standard Deviation of Sensitive Features") +
  scale_fill_brewer(palette = "Blues") +
  scale_x_continuous(limits = c(0, NA))
```

Interestingly, the impact of *Percentage Change* on many of these features is acute despite the spread of standard deviation being smaller. For example... [ADD OBSERVATION]

